status  equ 3h  ;?????????
tmr0   equ  1h
option_reg equ 81H
intcon      equ     0bh 
adcon0 equ 1fh
adcon1 equ 9fh
adresl equ 9eh
STATUS equ 03h
PCL equ  02h
pclath equ 0ah
INDF EQU 00H

Z equ 2h  ;??0??????
C EQU 00H	;??????0???
RP0  equ 5h  ;????????????RPO
RPl  equ 6h  ;????????????RP1

PORTA equ 05h
PORTB  equ 6h ;????B????????
PORTD  equ 8h
TRISB  equ 86h  ;????B??????????
PORTC  equ 7h  ;????C????????
PORTE  equ 9h  ;????C????????
TRISC  equ 87h  ;????C??????????
TRISA  equ 85h
TRISD  equ 88h
TRISE  equ 89h
TMP1   equ 58h	
lcdpc	equ  56h
lcdn    equ   57h
FSR   EQU 04H  ;???????????
option_reg equ 81h;?????????
rbup  equ 7  ;????????????

DATA1  equ 20h  ;???????????
DATA2  equ 21h  ;????????????
n2  equ 0ffh  ;????????????
COUNT1 equ 22h
COUNT2 EQU 23H

VALUE equ 24H ;??????????
TEMP  EQU 25H
TEST EQU 26H	;????????

GE EQU 27H
SHI EQU 28H
BAI EQU 29H
QIAN EQU 30H	
WAN EQU 3BH		;??????????

FLAG EQU 31H	;??????????flag
CALCFLAG EQU 32H	;???????flag
DISPFLAG EQU 33H	;?????????

PLUS1L	EQU 	60H
PLUS1H	EQU 	61H
PLUS2L	EQU 	62H
PLUS2H	EQU 	63H
RESL		EQU 	64H
RESH	EQU 	65H
MINUS1L	EQU 	67H
MINUS1H	EQU 	68H
MINUS2L	EQU 	69H
MINUS2H	EQU 	71H
NUM1L	EQU		72H
NUM1H	EQU		73H		;???????????
NUM2L	EQU		74H
NUM2H	EQU		75H

TEMPL EQU 35H
TEMPH EQU 36H
BCDL EQU 37H
BCDH EQU 38H	;BCD??????


MULTI1L	EQU	40H
MULTI1H	EQU	41H
MULTI2L	EQU	42H
MULTI2H	EQU	43H
MULTITEMP0 EQU 44H
MULTITEMP1 EQU 45H
MULTITEMP2 EQU 46H
MULTIRES0	EQU 47H
MULTIRES1	EQU 48H		;?????????
MULTIRES2	EQU 49H
MULTIRES3	EQU 50H		;?????????


YUSHUL		EQU 51H
YUSHUH		EQU	52H
GE_TEMP		EQU 53H
SHI_TEMP	EQU 54H
BAI_TEMP	EQU 55H
QIAN_TEMP   EQU 4FH


BIH	EQU 6AH
BIL	EQU 6BH			;BCD???????
BCD2 EQU	6CH
BCD1	EQU 6DH
BCD0	EQU 6EH		;????BCD??
COUNT 	EQU 2AH


rs equ 01h
rw equ 02h
re equ 03h

	org 0000h    ;?????????????
.	goto MAIN
	org 0005h
MAIN
	nop 
	bsf pclath,4
	call clear         ;????ICD????????
	bcf pclath,4
	BCF STATUS,6
	BSF STATUS,5
	movlw 08eh
	movwf adcon1
	movlw 00h
	MOVLW 00H
	MOVWF TRISC
	movwf TRISA
	MOVLW 	0F0H		;
	MOVWF 	TRISD		;??D(???)??????????
	MOVLW 0F0H
	movwf TRISB
	bcf 	STATUS,5
	bcf 	PORTA,re
	bcf 	PORTA,rs
	bcf		 PORTA,rw
	clrf 	PORTD
	movlw 	b'10000001'
	movwf 	adcon0
	bsf 	pclath,3
	bcf 	pclath,3
	;	call 	setf
	CLRF FLAG
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN	;???????
	CLRF MINUS1L
	CLRF MINUS1H
	CLRF MINUS2L
	CLRF MINUS1H
	CLRF PLUS1L
	CLRF PLUS1H
	CLRF PLUS2L
	CLRF PLUS2H
	CLRF CALCFLAG
	CLRF lcdn
	CLRF lcdpc
	;!!!!???
	CALL 	INITIALLCD;  ???LCD??
	
	GOTO   	START		;!!!!???

START		;?????????????????
	
    CALL SCAN 		;??????
    MOVF TEST,0		;?test??w
    ANDLW 0FFH		;w?0ffh???
    BTFSS STATUS,Z	;??z?1 test?00h,??z?0 test?0ffh ??
    
    GOTO CHECK1		;z?0 ??check1 ??
    GOTO START		;????????
	

CHECK1
    CALL SCAN		;????
    MOVF TEST,0		;?test??w
    ANDLW 0FFH		;check?????,???check2,????start
    BTFSS STATUS,Z
    
    GOTO CHECK2
    GOTO START

CHECK2		;!!!!?????????????!!!!
    CALL SEE 
	;CLRF GE
	;CLRF SHI
	;CLRF BAI
	;CLRF QIAN
	;CLRF FLAG
	;????????,value-2,????????1?value??9
	CALL CHECKFUNC
	MOVF VALUE,0
	;MOVLW VALUE
	BTFSS FLAG,0	;?flag??????1,1?????,0??????
	CALL WRITEGE
	;BSF FLAG,0	;?????????????? 
	;BTFSC FLAG,0	;?????1
	;MOVWF GE		;?????? ?value????
	BTFSS FLAG,1
	CALL PUSHSHI	
	BTFSS FLAG,2
	CALL PUSHBAI
	BTFSS FLAG,3
	CALL PUSHQIAN
	GOTO CHECK1
	
CHECKFUNC
	MOVF VALUE,0
	ADDLW 01H
	MOVWF TEMP
	BTFSC TEMP,4
	GOTO DOCLEAR
	MOVF VALUE,0
	MOVWF MINUS1L
	MOVLW 02H
	MOVWF MINUS2L
	CALL MINUS
	BTFSS RESL,3	;value?2,??????1xxx??0?????,?1,???flag
	RETURN 
	BTFSC RESL,7	;??????????1-2???????1
	RETURN
	BTFSS FLAG,0
	GOTO START
	;BTFSC RESL,7
	;RETURN
	;BTFSS RESL,7	
	CALL DETAILFUNC
	RETURN
	
DOPLUS
	CLRF CALCFLAG
	BSF CALCFLAG,0
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF NUM1L
	MOVF BCDH,0
	MOVWF NUM1H
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	
	MOVLW 2BH
	MOVWF lcdn
	MOVLW 84H
	MOVWF lcdpc
	call send
	
	;GE\SHI\BAI\QIAN ->PLUS1L\PLUS1H
	;CLRF GESHI???
	;READ GESHIBAIQIAN
	;READFUNC E
	;CALL PLUS
	;RESL\RESH ->GESHI???
	;DISPLAY	
	GOTO START2
SELFEQUAL
	MOVLW 3DH
	MOVWF lcdn
	MOVLW 94H
	MOVWF lcdpc
	call send
	CALL DISP_RES
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START
DOMINUS
	CLRF CALCFLAG
	BSF CALCFLAG,1
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF NUM1L
	MOVF BCDH,0
	MOVWF NUM1H
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	
	MOVLW 2DH
	MOVWF lcdn
	MOVLW 84H
	MOVWF lcdpc
	call send
	GOTO START2
	
	
DOMULTI
	CLRF CALCFLAG
	BSF CALCFLAG,2
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF NUM1L
	MOVF BCDH,0
	MOVWF NUM1H
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	MOVLW 78H
	MOVWF lcdn
	MOVLW 84H
	MOVWF lcdpc
	call send
	GOTO START2
	
		

DODIVIDE
	CLRF CALCFLAG
	BSF CALCFLAG,3
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF NUM1L
	MOVF BCDH,0
	MOVWF NUM1H
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	MOVLW 84H
	MOVWF lcdpc
	MOVLW 02fH
	MOVWF lcdn
	call send
	;movlw 0C2H
	;call SEND_INS  ;???/????
	GOTO START2
	

DOCLEAR
	MOVLW 43H
	MOVWF lcdn
	MOVLW 84H
	MOVWF lcdpc
	call send
	
	CLRF CALCFLAG
	CLRF FLAG
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CALL INITIALLCD
	
	GOTO START


DETAILFUNC
	BTFSC CALCFLAG,0	
	GOTO START
	BTFSC CALCFLAG,1
	GOTO START
	BTFSC CALCFLAG,2
	GOTO START
	BTFSC CALCFLAG,3
	GOTO START

	MOVF RESL,0
	MOVWF TEMP
	DECF TEMP
	BTFSS TEMP,3
	CALL DOPLUS		;????

	DECF TEMP
	BTFSS TEMP,3
	CALL DOMINUS		;????
		
	DECF TEMP
	BTFSS TEMP,3
	CALL DOMULTI		;????
	

	DECF TEMP
	BTFSS TEMP,3
	CALL DODIVIDE		;????

	
	DECF TEMP
	BTFSS TEMP,3
	CALL SELFEQUAL		;
	
	
	DECF TEMP
	BTFSC TEMP,3
	CALL DOCLEAR		;????

	RETURN
	;MOVF VALUE,0
	;ANDLW 0EH
	;BTFSS STATUS,Z
	;BSF CALCFLAG,1
WRITEGE
	BSF FLAG,0	;?????????????? 
	MOVF VALUE,0
	MOVWF GE		;?????? ?value????
	CALL	DELAY
	CALL INITIALLCD
	MOVF GE,0
	ADDLW 30H			;!??????
	MOVWF lcdn
	MOVLW 80H
	MOVWF lcdpc
	call send 	
	GOTO CHECK1
	
	
PUSHSHI
	BSF FLAG,1
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H		;!??????
	MOVWF lcdn
	MOVLW 81H
	MOVWF lcdpc
	call send 	
	GOTO CHECK1
	
	GOTO CHECK1

PUSHBAI
	BSF FLAG,2
	MOVF SHI,0
	MOVWF BAI
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H		;!??????
	MOVWF lcdn
	MOVLW 82H
	MOVWF lcdpc
	call send
	GOTO CHECK1


PUSHQIAN
	BSF FLAG,3	
	MOVF BAI,0
	MOVWF QIAN
	MOVF SHI,0
	MOVWF BAI
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H		;!??????
	MOVWF lcdn
	MOVLW 83H
	MOVWF lcdpc
	call send
	GOTO CHECK1

    
WAIT
    CALL DELAY
    CALL DELAY
    CALL SCAN
    MOVF TEST,0
    ANDLW 0FFH
    BTFSS STATUS,Z 
    
    GOTO WAIT
    GOTO START
;****??????????

;*****????????
START2		;?????????????????
	
    CALL SCAN 		;??????
   MOVF TEST,0		;?test??w
    ANDLW 0FFH		;w?0ffh???
    BTFSS STATUS,Z	;??z?1 test?00h,??z?0 test?0ffh ??
    
    GOTO CHECK1A		;z?0 ??CHECK1A ??
    GOTO START2		;????????
	

CHECK1A
    CALL SCAN		;????
    MOVF TEST,0		;?test??w
    ANDLW 0FFH		;check?????,???CHECK2A,????start
    BTFSS STATUS,Z
    
    GOTO CHECK2A
    GOTO START2

CHECK2A		;!!!!?????????????!!!!
    CALL SEE 
	;CLRF GE
	;CLRF SHI
	;CLRF BAI
	;CLRF QIAN
	;CLRF FLAG
	;????????,value-2,????????1?value??9
	CALL CHECKFUNC2
	MOVF VALUE,0
	;MOVLW VALUE
	BTFSS FLAG,0	;?flag??????1,1?????,0??????
	CALL WRITEGE2
	;BSF FLAG,0	;?????????????? 
	;BTFSC FLAG,0	;?????1
	;MOVWF GE		;?????? ?value????
	BTFSS FLAG,1
	CALL PUSHSHI2	
	BTFSS FLAG,2
	CALL PUSHBAI2
	BTFSS FLAG,3
	CALL PUSHQIAN2
	GOTO CHECK1A
	
CHECKFUNC2
	MOVF VALUE,0
	ADDLW 01H
	MOVWF TEMP
	BTFSC TEMP,4
	GOTO DOCLEAR
	MOVF VALUE,0
	MOVWF MINUS1L
	MOVLW 02H
	MOVWF MINUS2L
	CALL MINUS
	BTFSS RESL,3	;value?2,??????1xxx??0?????,?1,???flag
	RETURN 
	BTFSC RESL,7	;??????????1-2???????1
	RETURN
	BTFSS FLAG,0
	GOTO START2
	;BTFSC RESL,7
	;RETURN
	;BTFSS RESL,7	
	CALL DETAILFUNC2
	RETURN
	


DOEQUAL
	
	MOVLW 3DH
	MOVWF lcdn
	MOVLW 94H
	MOVWF lcdpc
	call send
	BTFSC CALCFLAG,0
	GOTO CALCPLUS		;???????,??????
	BTFSC CALCFLAG,1
	GOTO CALCMINUS		;??
	BTFSC CALCFLAG,2
	GOTO CALCMULTI		;??
	BTFSC CALCFLAG,3
	GOTO CALCDIVIDE		;??
	;???????	
CALCPLUS
	CLRF CALCFLAG
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF PLUS2L
	MOVF BCDH,0		;???????????,????
	MOVWF PLUS2H
	MOVF NUM1L,0
	MOVWF PLUS1L
	MOVF NUM1H,0
	MOVWF PLUS1H
	CALL PLUS
	MOVF RESL,0
	MOVWF BIL
	MOVF RESH,0
	MOVWF BIH
	
	CALL BI_BCD
	CALL DISP_RES
	;CALL BI_BCD????bcd?8421
	;CALL PRINT?????
	
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START

DISP_RES
	CALL DET_FLAG
	MOVWF DISPFLAG
	MOVF GE,0
	ADDLW 30H		
	MOVWF lcdn
	MOVLW 8FH
	MOVWF lcdpc
	BTFSC DISPFLAG,0
	call send 	
	MOVF SHI,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8EH
	MOVWF lcdpc
	BTFSC DISPFLAG,1
	call send
	MOVF BAI,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8DH
	MOVWF lcdpc
	BTFSC DISPFLAG,2
	call send
	MOVF QIAN,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8CH
	MOVWF lcdpc
	BTFSC DISPFLAG,3
	call send
	MOVF WAN,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8BH
	MOVWF lcdpc
	BTFSC DISPFLAG,4
	call send 	
	RETURN

DISP_ERROR
	MOVLW 72H
	MOVWF lcdn
	MOVLW 8FH
	MOVWF lcdpc
	call send
	MOVLW 6FH 	
	MOVWF lcdn
	MOVLW 8EH
	MOVWF lcdpc
	call send
	MOVLW 72H	
	MOVWF lcdn
	MOVLW 8DH
	MOVWF lcdpc
	call send
	MOVLW 72H	
	MOVWF lcdn
	MOVLW 8CH
	MOVWF lcdpc
	call send
	MOVLW 65H
	MOVWF lcdn
	MOVLW 8BH
	MOVWF lcdpc
	call send 
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START



DET_FLAG
	MOVLW 01FH  
	BTFSC DISPFLAG,4
	RETURN
	MOVLW 0FH
	BTFSC DISPFLAG,3
	RETURN
	MOVLW 07H
	BTFSC DISPFLAG,2
	RETURN 
	MOVLW 03H
	BTFSC DISPFLAG,1
	RETURN
	MOVLW 01H
	RETURN
DISP_RES_NEG
	CALL DET_FLAG
	MOVWF DISPFLAG
	MOVF GE,0
	ADDLW 30H		
	MOVWF lcdn
	MOVLW 8FH
	MOVWF lcdpc
	BTFSC DISPFLAG,0
	call send 	
	MOVF SHI,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8EH
	MOVWF lcdpc
	BTFSC DISPFLAG,1
	call send
	MOVF BAI,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8DH
	MOVWF lcdpc
	BTFSC DISPFLAG,2
	call send
	MOVF QIAN,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8CH
	MOVWF lcdpc
	BTFSC DISPFLAG,3
	call send
	MOVF WAN,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8BH
	MOVWF lcdpc
	BTFSC DISPFLAG,4
	call send 	
	MOVLW 2DH
	MOVWF lcdn
	MOVLW 8AH
	MOVWF lcdpc
	call send 	
	
	RETURN


DISP_RES_DIV
	
	MOVF GE,0
	ADDLW 30H		
	MOVWF lcdn
	MOVLW 8FH
	MOVWF lcdpc
	call send 	
	MOVF SHI,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8EH
	MOVWF lcdpc
	call send
	
	MOVLW 2EH
	MOVWF lcdn
	MOVLW 8DH
	MOVWF lcdpc
	call send
	MOVLW 8CH
	MOVWF lcdpc
	call send
	
	MOVF GE_TEMP,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8BH
	MOVWF lcdpc
	call send
	MOVF SHI_TEMP,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 8AH
	MOVWF lcdpc
	call send
	MOVF BAI_TEMP,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 89H
	MOVWF lcdpc
	call send 	
	
	MOVF QIAN_TEMP,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 88H
	MOVWF lcdpc
	call send
	RETURN

NEGMINUS
	MOVF NUM2H,0
	MOVWF MINUS1H
	MOVF NUM2L,0
	MOVWF MINUS1L
	MOVF NUM1L,0
	MOVWF MINUS2L
	MOVF NUM1H,0
	MOVWF MINUS2H
	CALL MINUS
	MOVF RESL,0
	MOVWF BIL
	MOVF RESH,0
	MOVWF BIH
	CALL BI_BCD
	CALL DISP_RES_NEG
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START


CALCMINUS
	CLRF CALCFLAG
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF NUM2L
	MOVWF MINUS2L
	MOVF BCDH,0		;???????????,????
	MOVWF NUM2H
	MOVWF MINUS2H
	MOVF NUM1L,0
	MOVWF MINUS1L
	MOVF NUM1H,0
	MOVWF MINUS1H
	MOVLW 01H
	BTFSS FLAG,1
	MOVF GE,0
	ADDWF 00H,0
	MOVWF TEMP
	BTFSS TEMP,0
	GOTO ZEROMINUS
	CALL MINUS
	MOVF RESL,0
	MOVWF BIL
	MOVF RESH,0
	MOVWF BIH
	CALL BI_BCD
	BTFSC DISPFLAG,4
	CALL NEGMINUS
	CALL DISP_RES
	;CALL BI_BCD????bcd?8421
	;CALL PRINT?????
	
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START
	
ZEROMINUS
	MOVF NUM1L,0
	MOVWF BIL
	MOVF NUM1H,0
	MOVWF BIH
	CALL BI_BCD
	CALL DISP_RES
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START
CALCMULTI
	CLRF CALCFLAG
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF MULTI2L
	MOVF BCDH,0		;???????????,????
	MOVWF MULTI2H
	MOVF NUM1L,0
	MOVWF MULTI1L
	MOVF NUM1H,0
	MOVWF MULTI1H
	CALL MULTI
	MOVF MULTIRES2,0
	ADDWF 00H,0
	MOVWF TEMP
	BTFSC TEMP,0
	CALL DISP_ERROR
	MOVF MULTIRES0,0
	MOVWF BIL
	MOVF MULTIRES1,0
	MOVWF BIH
	
	CALL BI_BCD
	CALL DISP_RES
	;CALL BI_BCD????bcd?8421
	;CALL PRINT?????
	
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START
	
CALCDIVIDE
	CLRF CALCFLAG
	;BTFSS FLAG,1
	
	;CALL DISP_ERROR
	CALL BCD_BI
	MOVF BCDL,0
	MOVWF MINUS2L
	MOVF BCDH,0		;???????????,????
	MOVWF MINUS2H
	MOVF NUM1L,0
	MOVWF MINUS1L
	MOVF NUM1H,0
	MOVWF MINUS1H
	MOVLW 01H
	BTFSS FLAG,1
	MOVF GE,0
	ADDWF 00H,0
	MOVWF TEMP
	BTFSS TEMP,0
	GOTO DISP_ERROR
	CALL DIVIDE
	MOVF RESL,0
	MOVWF BIL
	MOVF RESH,0
	MOVWF BIH
	;MOVF RESL,0
	;MOVWF BIL
	;MOVF RESH,0
	;MOVWF BIH
	
	CALL BI_BCD
	MOVF GE,0
	MOVWF GE_TEMP
	MOVF SHI,0
	MOVWF SHI_TEMP
	MOVF BAI,0
	MOVWF BAI_TEMP
	MOVF QIAN,0
	MOVWF QIAN_TEMP
	MOVF YUSHUL,0
	MOVWF BIL
	MOVF YUSHUH,0
	MOVWF BIH
	CALL BI_BCD
	
	CALL DISP_RES_DIV
	;CALL BI_BCD????bcd?8421
	;CALL PRINT?????
	
	CLRF GE
	CLRF SHI
	CLRF BAI
	CLRF QIAN
	CLRF FLAG
	CLRF VALUE
	CLRF CALCFLAG
	GOTO START
	

	
DETAILFUNC2
	;BTFSC CALCFLAG,0	;!!!????
	;GOTO START2
	;BTFSC CALCFLAG,1
	;GOTO START2
	;BTFSC CALCFLAG,2
	;GOTO START2
	;BTFSC CALCFLAG,3
	;GOTO START2

	MOVF VALUE,0
	ADDLW 02H
	MOVWF TEMP
	BTFSC TEMP,4
	CALL DOEQUAL		;?????????,???????
						;??????,??start2???
	GOTO START2

	
WRITEGE2
	BSF FLAG,0	;?????????????? 
	MOVF VALUE,0
	MOVWF GE		;?????? ?value????
	CALL	DELAY
	MOVF GE,0
	ADDLW 30H		
	MOVWF lcdn
	MOVLW 90H
	MOVWF lcdpc
	call send 	
	GOTO CHECK1A
	
	
PUSHSHI2
	BSF FLAG,1
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H	
	MOVWF lcdn
	MOVLW 91H
	MOVWF lcdpc
	call send 	
	GOTO CHECK1A
	
	GOTO CHECK1A

PUSHBAI2
	BSF FLAG,2
	MOVF SHI,0
	MOVWF BAI
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H		;!??????
	MOVWF lcdn
	MOVLW 92H
	MOVWF lcdpc
	call send
	GOTO CHECK1A


PUSHQIAN2
	BSF FLAG,3	
	MOVF BAI,0
	MOVWF QIAN
	MOVF SHI,0
	MOVWF BAI
	MOVF GE,0
	MOVWF SHI
	MOVF VALUE,0
	MOVWF GE
	CALL DELAY
	MOVF GE,0
	ADDLW 30H		;!??????
	MOVWF lcdn
	MOVLW 93H
	MOVWF lcdpc
	call send
	GOTO CHECK1A

    
WAIT2
    CALL DELAY
    CALL DELAY
    CALL SCAN
    MOVF TEST,0
    ANDLW 0FFH
    BTFSS STATUS,Z 
    
    GOTO WAIT2
    GOTO START2

;****??????????
SCAN
    MOVLW 0F0H
  MOVWF PORTD
    MOVF PORTD,0
    IORLW 0FH
    MOVWF TEMP
    
    COMF TEMP,1
    BTFSS STATUS,Z 
    
    GOTO SCAN1
    MOVLW 00H 
    MOVWF TEST
    GOTO SCAN2

SCAN1
   MOVLW 0FFH
    MOVWF TEST

SCAN2 
    RETURN 
;****??????
;*******????

SEE
     MOVLW 0F0H   ;????0000,??????
    MOVWF PORTD
    MOVF PORTD,0
    MOVWF TEMP
    
    BTFSS TEMP,4	;??4-6??????
    GOTO BIT41		;???????
    BTFSS TEMP,5	;?????????3(RD7)
    GOTO BIT51		;value??????????
    BTFSS TEMP,6
    GOTO BIT61
    
    MOVLW 0CH 
    MOVWF VALUE 
    GOTO NEXT1

BIT41
    MOVLW 00H 
    MOVWF VALUE 
    GOTO NEXT1

BIT51
    MOVLW 04H 
    MOVWF VALUE 
    GOTO NEXT1

BIT61
    MOVLW 08H 
    MOVWF VALUE 
    GOTO NEXT1

NEXT1
    MOVLW 0EH    ;????????????????
    MOVWF PORTD 	;??0?(RD0)???
    MOVF PORTD,0	;????,?value????RD?
    IORLW 0FH
    
    MOVWF TEMP
    COMF TEMP,1
    BTFSS STATUS,Z
    GOTO NO1
    
    MOVLW 0DH
    MOVWF PORTD
    MOVF PORTD,0
    IORLW 0FH
    MOVWF TEMP
    
    COMF TEMP,1
    BTFSS STATUS,Z 
    GOTO NO2
    
    MOVLW 0BH
    MOVWF PORTD
    MOVF PORTD,0
    IORLW 0FH
    MOVWF TEMP
    
    COMF TEMP,1
    BTFSS STATUS,Z 
    GOTO NO3
    
    INCF VALUE 
    INCF VALUE 
    INCF VALUE 
    GOTO NEXT2

NO1 
    GOTO NEXT2
NO2
    INCF VALUE 
    GOTO NEXT2
NO3 
    INCF VALUE 
    INCF VALUE 
    GOTO NEXT2
NEXT2
	MOVF VALUE,0
	ADDLW 0F0H
	MOVWF VALUE
	COMF VALUE
    RETURN
;*****????
DELAY
    MOVLW COUNT1
    MOVWF DATA1
LOOP1
    MOVLW COUNT2
    MOVWF DATA2
LOOP2
    DECFSZ DATA1,1
    GOTO LOOP2
    DECFSZ DATA2,1
    GOTO LOOP2

    RETURN

;***BCD????
BCD_BI
	NOP
	MOVLW 00H
	MOVWF PLUS1L
	MOVWF PLUS1H
	MOVWF PLUS2L
	MOVWF PLUS2H		;???
	MOVWF BCDL
	MOVWF BCDH
	
	;MOVLW 01H
	;MOVWF QIAN
	;MOVLW 02H
	;MOVWF BAI
	;MOVLW 03H
	;MOVWF SHI
	;MOVLW 04H
	;MOVWF GE		;????

	MOVLW 0XE8
	MOVWF MULTI1L
	MOVLW 0X03
	MOVWF MULTI1H
	MOVLW 00H
	MOVWF MULTI2H
	
	MOVF QIAN,0
	MOVWF MULTI2L
	
	CALL MULTI		;???1000

	
	MOVF MULTIRES0,0
	MOVWF	TEMPL	;???1000,
	MOVF	MULTIRES1,0
	MOVWF TEMPH

	CALL DIEDAI
	
	MOVLW 0X64
	MOVWF MULTI1L
	MOVLW 0X00
	MOVWF MULTI1H
	MOVWF MULTI2H
	MOVF BAI,0
	MOVWF MULTI2L
	
	CALL MULTI		;???100

	
	MOVF MULTIRES0,0
	MOVWF	TEMPL	
	MOVF	MULTIRES1,0
	MOVWF TEMPH		;????temp
	CALL DIEDAI	;???bcd

	MOVLW 0AH
	MOVWF MULTI1L
	MOVF SHI,0
	MOVWF MULTI2L
	MOVLW 0X00
	MOVWF MULTI1H
	MOVWF MULTI2H
	CALL MULTI		;???10

	
	MOVF MULTIRES0,0
	MOVWF	TEMPL	
	MOVF	MULTIRES1,0
	MOVWF TEMPH		;????temp
	CALL DIEDAI	;???bcd
	

	MOVF GE,0	;??????temp??
	MOVWF	TEMPL	
	MOVLW	00H
	MOVWF TEMPH		;????temp
	CALL DIEDAI	;???bcd
	
	RETURN	;??????BCDL?BCDH

DIEDAI	
	MOVF TEMPH,0
	MOVWF PLUS1H
	MOVF BCDH,0
	MOVWF PLUS2H
	
	MOVF TEMPL,0
	MOVWF PLUS1L
	MOVF BCDL,0
	MOVWF PLUS2L	;???????????????1?,???????BCD?
	CALL PLUS
	
	MOVF RESL,0
	MOVWF BCDL
	MOVF RESH,0
	MOVWF BCDH	;???????BCD?
	RETURN	

;***????BCD

BI_BCD
	;MOVLW 0FFH
	;MOVWF	HH
	;MOVLW	0FFH
	;MOVWF LL   ?????
	MOVLW 00H
	MOVWF BCD2
	MOVWF BCD1
	MOVWF BCD0
	
	BCF STATUS,C
	MOVLW 10H
	MOVWF COUNT
BCDLOOP
	RLF BIL
	RLF BIH
	RLF BCD0
	RLF BCD1
	RLF BCD2
	
	DECFSZ COUNT
	GOTO BCDNEXT1
	GOTO BCDNEXT2
BCDNEXT1
	MOVLW	BCD0
	MOVWF 	FSR
	CALL	TIAOZHENG
	MOVLW	BCD1
	MOVWF	FSR
	CALL	TIAOZHENG
	MOVLW 	BCD2
	MOVWF	FSR
	CALL 	TIAOZHENG
	GOTO	BCDLOOP

BCDNEXT2
	NOP
	CLRF DISPFLAG
	MOVF BCD0,0
	MOVWF GE
	BCF GE,7
	BCF GE,6
	BCF GE,5
	BCF GE,4
	BTFSC GE,0
	BSF DISPFLAG,0
	BTFSC GE,1
	BSF DISPFLAG,0	
	BTFSC GE,2
	BSF DISPFLAG,0
	BTFSC GE,3
	BSF DISPFLAG,0
	

	MOVF BCD0,0
	MOVWF SHI
	RRF SHI
	RRF SHI
	RRF SHI
	RRF SHI
	BCF SHI,7
	BCF SHI,6
	BCF SHI,5
	BCF SHI,4
	BTFSC SHI,0
	BSF DISPFLAG,1
	BTFSC SHI,1
	BSF DISPFLAG,1	
	BTFSC SHI,2
	BSF DISPFLAG,1
	BTFSC SHI,3
	BSF DISPFLAG,1

	MOVF BCD1,0
	MOVWF BAI
	BCF BAI,7
	BCF BAI,6
	BCF BAI,5
	BCF BAI,4
	BTFSC BAI,0
	BSF DISPFLAG,2
	BTFSC BAI,1
	BSF DISPFLAG,2	
	BTFSC BAI,2
	BSF DISPFLAG,2
	BTFSC BAI,3
	BSF DISPFLAG,2

	MOVF BCD1,0
	MOVWF QIAN
	RRF QIAN
	RRF QIAN
	RRF QIAN
	RRF QIAN
	BCF QIAN,7
	BCF QIAN,6
	BCF QIAN,5
	BCF QIAN,4
	BTFSC QIAN,0
	BSF DISPFLAG,3
	BTFSC QIAN,1
	BSF DISPFLAG,3	
	BTFSC QIAN,2
	BSF DISPFLAG,3
	BTFSC QIAN,3
	BSF DISPFLAG,3

	MOVF BCD2,0
	MOVWF WAN
	BCF WAN,7
	BCF WAN,6
	BCF WAN,5
	BCF WAN,4
	BTFSC WAN,0
	BSF DISPFLAG,4
	BTFSC WAN,1
	BSF DISPFLAG,4	
	BTFSC WAN,2
	BSF DISPFLAG,4
	BTFSC WAN,3
	BSF DISPFLAG,4	
	
	RETURN
TIAOZHENG
	MOVLW 03H
	ADDWF	INDF,0
	MOVWF	TEMP
	BTFSC	TEMP,3
	MOVWF	INDF
	MOVLW	30H
	ADDWF	INDF,0
	MOVWF	TEMP
	BTFSC	TEMP,7
	MOVWF 	INDF
	RETURN


;*******????
PLUS
	;MOVLW	0X32		;???1?????
	;MOVWF	PLUS1L
	;MOVLW	0X5E
	;MOVWF	PLUS1H		;???1?????
	;MOVLW	0XAC
	;MOVWF	PLUS2L		;???2?????
	;MOVLW	0X81
	;MOVWF	PLUS2H
	MOVWF	00H
	MOVWF 	RESL
	MOVWF	RESH  		;????
	BCF		STATUS,C	;???????
	MOVF 	PLUS1L,0
	ADDWF 	PLUS2L,0	;????
	MOVWF	RESL
	BTFSC	STATUS,C	;???????
	INCF 	PLUS1H
	MOVF 	PLUS1H,0
	ADDWF 	PLUS2H,0	;????,?????
	MOVWF	RESH
	NOP
	return

MINUS
	;MOVLW	0X32
	;MOVWF	MINUS1L
	;MOVLW	0X5E
	;MOVWF	MINUS1H		;??????
	;MOVLW	6BH
	;MOVWF	MINUS2L
	;MOVLW	25H
	;MOVWF	MINUS2H		;?????
	MOVWF	00H
	MOVWF 	RESL
	MOVWF	RESH  		;????
	COMF	MINUS2L
	COMF 	MINUS2H		;?????
	BCF		STATUS,C
	INCF 	MINUS2L		
	BTFSS	STATUS,C	;?????????,????????
	GOTO	NEXT
	INCF 	MINUS2H
	return
NEXT
	BCF		STATUS,C	;
	MOVF	MINUS1L,0
	ADDWF	MINUS2L,0	;????????????
	MOVWF	RESL
	
	BTFSC	STATUS,C
	INCF	MINUS1H
	MOVF	MINUS1H,0
	ADDWF 	MINUS2H,0
	MOVWF	RESH
	NOP
	return
;********

MULTI
	;MOVLW	32H
	;MOVWF	MULT1
	;MOVLW	5EH
	;MOVWF	MULT2

	MOVLW 	00H
	MOVWF	MULTIRES0
	MOVWF	MULTIRES1
	MOVWF	MULTIRES2
	MOVWF	MULTIRES3
	
	MOVLW 10H
	MOVWF MULTITEMP2
	MOVF MULTI2L,0
	
	MOVWF MULTITEMP0
	MOVF MULTI2H,00
	MOVWF MULTITEMP1

LOOP
	BCF STATUS,C
	RRF MULTITEMP1
	RRF MULTITEMP0

	BTFSC STATUS,C
	GOTO ADD16
	GOTO MNEXT1
ADD16
	MOVF MULTI1L,0
	ADDWF MULTIRES2	
	
	BTFSC	STATUS,C
	INCF MULTIRES3
	MOVF MULTI1H,0
	ADDWF MULTIRES3
MNEXT1
	BCF STATUS,C
	RRF MULTIRES3
	RRF MULTIRES2
	RRF MULTIRES1
	RRF MULTIRES0
	DECFSZ MULTITEMP2
	GOTO LOOP
	NOP
	NOP
	RETURN

DIVIDE
	;MOVLW  0X15
	;MOVWF	MINUS1L
	;MOVLW  0X40
	;MOVWF	MINUS1H		;??????????
	
	;MOVLW  0X10
	;MOVWF	MINUS2L
	;MOVLW  00h
	;MOVWF	MINUS2H		;?????????

	
	MOVLW  00H
	MOVWF	YUSHUH
	MOVWF   YUSHUL		;????
	MOVWF 	RESL
	MOVWF   RESH		;???

	MOVLW  10H
	MOVWF	TEMP		;??????????	
	MOVF 	MINUS1L,0

	MOVWF	TEMPL
	MOVF	MINUS1H,00
	MOVWF	TEMPH		;??????TEMPH/L?

LOOPD
	BCF		STATUS,C	;???????
	RLF		TEMPL
	RLF		TEMPH		;???????
	RLF		YUSHUL
	RLF		YUSHUH		;??????
	
	MOVF	MINUS2H,0	;??h-??h
	SUBWF	YUSHUH,0
	BTFSS	STATUS,Z	;????h???h???
	GOTO	NO1D
	MOVF	MINUS2L,0	;???l-??l??
	SUBWF	YUSHUL,0
NO1D
	BTFSS	STATUS,C
	GOTO 	NO2D
	MOVF	MINUS2L,0
	SUBWF	YUSHUL
	BTFSS	STATUS,C
	DECF	YUSHUH
	MOVF	MINUS2H,0
	SUBWF	YUSHUH
	BSF		STATUS,C	;????
NO2D
	RLF		RESL		;?????
	RLF		RESH
	DECFSZ	TEMP		;????????
	GOTO 	LOOPD
	RETURN

;***

DELAY5               
   MOVLW    0FFH         ;????????FFH??W
  MOVWF    20H          ;??????????20H??
LPPP0
  MOVLW    09FH         ;????????FFH??W
   MOVWF    21H          ;??????????21H??
LPPP1
   DECFSZ   21H,1        ;??21H????,??0??
   GOTO      LPPP1         ;???LP1?
   DECFSZ    20H,1       ;??20H????,??0??
   GOTO      LPPP0         ;???LP0?
   RETURN                ;?????

INITIALLCD
	CALL    DELAY5             ;????,???LCD??????PIC?(196MS)
	MOVLW   01H
	MOVWF   PORTC             ;????,??????,??????
	CALL   ENABLE            ;???????
	MOVLW   38H
	MOVWF   PORTC                
	CALL   ENABLE
	MOVLW   0CH             
	MOVWF   PORTC
	CALL   ENABLE       
	MOVLW   06H              
    MOVWF   PORTC
    CALL ENABLE
    RETURN
ENABLE
	;call fuckdog
    BCF   PORTA,rs        ;??????????
    BCF   PORTA,rw
    BCF   PORTA,re
    CALL   DELAY5  ;?????  
    BSF   PORTA,re
    RETURN
send
	CALL  DELAY5
    movf lcdpc,w
    MOVWF   PORTC             
    CALL   ENABLE
	movf   lcdn,w
   call SEND_INS
	return
SEND_INS
	;movf  keyboard,w
    MOVWF   PORTC           
    BSF   PORTA,rs
 	BCF   PORTA,rw
    BCF   PORTA,re
    NOP
    NOP
   	NOP
    NOP    
    BSF   PORTA,re
    RETURN

setf
	CALL INITIALLCD;  ???LCD??
	CALL  DELAY5
	movlw 80h
	movwf lcdpc		;????
	movlw 0ceh
	movwf lcdn
	call send
	movlw 0d2h
	call SEND_INS  ;?????
	
	movlw 81h
	movwf lcdpc
	movlw 0d0h
	movwf lcdn
	call send
	movlw 0b4h
	call SEND_INS ;??
	return

setff
	CALL INITIALLCD;  ???LCD??
	CALL  DELAY5
	movlw 80h
	movwf lcdpc		;????
	movlw 0ceh
	movwf lcdn
	call send
	movlw 0d2h
	call SEND_INS  ;?????
	
	movlw 81h
	movwf lcdpc
	movlw 0d0h
	movwf lcdn
	call send
	movlw 0b4h
	call SEND_INS ;??
	return


org 1004h

clear
	movlw 20h
	movwf FSR
ss	clrf  0h
	incf FSR,1
	movf FSR,w
	xorlw 06fh
	;btfss status,z   ;?????1???!?????
	;goto ss
	return

end